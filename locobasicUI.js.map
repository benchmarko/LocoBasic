{"version":3,"file":"locobasicUI.js","sources":["../src/UI/UI.ts"],"sourcesContent":["// UI.ts\n\nimport type { Editor } from 'codemirror';\nimport type { ICore, IUI, ConfigType } from \"../Interfaces\";\n\n// Worker:\ntype PlainErrorEventType = {\n\tlineno: number,\n\tcolno: number,\n\tmessage: string\n};\n\ntype ProcessingQueueType = {\n\tresolve: (value: PlainErrorEventType) => void,\n\tjsText: string\n};\n\n// based on: https://stackoverflow.com/questions/35252731/find-details-of-syntaxerror-thrown-by-javascript-new-function-constructor\n// https://stackoverflow.com/a/55555357\nconst workerFn = () => {\n\tconst doEvalAndReply = (jsText: string) => {\n\t\tself.addEventListener(\n\t\t\t'error',\n\t\t\t(errorEvent) => {\n\t\t\t\t// Don't pollute the browser console:\n\t\t\t\terrorEvent.preventDefault();\n\t\t\t\t// The properties we want are actually getters on the prototype;\n\t\t\t\t// they won't be retrieved when just stringifying so, extract them manually, and put them into a new object:\n\t\t\t\tconst { lineno, colno, message } = errorEvent;\n\t\t\t\tconst plainErrorEventObj: PlainErrorEventType = { lineno, colno, message };\n\t\t\t\tself.postMessage(JSON.stringify(plainErrorEventObj));\n\t\t\t},\n\t\t\t{ once: true }\n\t\t);\n\t\t/* const fn = */ new Function(\"_o\", jsText);\n\t\tconst plainErrorEventObj: PlainErrorEventType = {\n\t\t\tlineno: -1,\n\t\t\tcolno: -1,\n\t\t\tmessage: 'No Error: Parsing successful!'\n\t\t};\n\t\tself.postMessage(JSON.stringify(plainErrorEventObj));\n\t};\n\tself.addEventListener('message', (e) => {\n\t\tdoEvalAndReply(e.data);\n\t});\n};\n\n\nexport class UI implements IUI {\n\tprivate readonly core: ICore;\n\tprivate basicCm?: Editor;\n\tprivate compiledCm?: Editor;\n\t//private outputAsHtml = false;\n\t//private static worker?: Worker;\n\tprivate static getErrorEvent?: (s: string) => Promise<PlainErrorEventType>;\n\n\tconstructor(core: ICore) {\n\t\tthis.core = core;\n\t}\n\n\tprivate debounce<T extends (...args: unknown[]) => void | Promise<void>>(func: T, delayPara: string): (...args: Parameters<T>) => void {\n\t\tlet timeoutId: ReturnType<typeof setTimeout>;\n\t\tconst core = this.core;\n\t\treturn function (this: unknown, ...args: Parameters<T>) {\n\t\t\tconst context = this;\n\t\t\tconst delay = core.getConfig<number>(delayPara);\n\t\t\tclearTimeout(timeoutId);\n\t\t\ttimeoutId = setTimeout(() => {\n\t\t\t\tfunc.apply(context, args);\n\t\t\t}, delay);\n\t\t};\n\t}\n\n\tprivate static asyncDelay(fn: () => void, timeout: number) {\n\t\treturn (async () => {\n\t\t\tconst timerId = setTimeout(fn, timeout);\n\t\t\treturn timerId;\n\t\t})();\n\t}\n\n\t/*\n\tpublic addOutputHtml(value: string) {\n\t\tconst outputText = document.getElementById(\"outputText\") as HTMLPreElement;\n\t\toutputText.innerHTML += value;\n\t\tthis.outputAsHtml = true;\n\t}\n\t*/\n\n\tpublic addOutputText(value: string) {\n\t\t//const outputText = document.getElementById(\"outputText\") as HTMLTextAreaElement;\n\t\t//outputText.value += value;\n\t\tconst outputText = document.getElementById(\"outputText\") as HTMLPreElement;\n\t\t//if (this.outputAsHtml) {\n\t\toutputText.innerHTML += value;\n\t\t//} else {\n\t\t//\toutputText.innerText += value;\n\t\t//}\n\t}\n\n\tpublic setOutputText(value: string) {\n\t\t//const outputText = document.getElementById(\"outputText\") as HTMLTextAreaElement;\n\t\t//outputText.value = value;\n\t\tconst outputText = document.getElementById(\"outputText\") as HTMLPreElement;\n\t\toutputText.innerText = value;\n\t\t//this.outputAsHtml = false;\n\t}\n\n\tprivate static readonly colorsForPens: string[] = [\n\t\t\"#000080\", //  1 Navy\n\t\t\"#FFFF00\", // 24 Bright Yellow\n\t\t\"#00FFFF\", // 20 Bright Cyan\n\t\t\"#FF0000\", //  6 Bright Red\n\t\t\"#FFFFFF\", // 26 Bright White\n\t\t\"#000000\", //  0 Black\n\t\t\"#0000FF\", //  2 Bright Blue\n\t\t\"#FF00FF\", //  8 Bright Magenta\n\t\t\"#008080\", // 10 Cyan\n\t\t\"#808000\", // 12 Yellow\n\t\t\"#8080FF\", // 14 Pastel Blue\n\t\t\"#FF8080\", // 16 Pink\n\t\t\"#00FF00\", // 18 Bright Green\n\t\t\"#80FF80\", // 22 Pastel Green\n\t\t\"#000080\", //  1 Navy (repeated)\n\t\t\"#FF8080\", // 16 Pink (repeated)\n\t\t\"#000080\"  //  1 Navy (repeated)\n\t];\n\n\tpublic getPaperColors() {\n\t\treturn UI.colorsForPens.map((color) => `<span style=\"background-color: ${color}\">`);\n\t}\n\n\tpublic getPenColors() {\n\t\treturn UI.colorsForPens.map((color) => `<span style=\"color: ${color}\">`);\n\t}\n\n\t/*\n\tpublic setColor(color: number, asBackground: boolean) {\n\t\tconst colorStr = UI.colorsForPens[color];\n\t\tif (asBackground) {\n\t\t\tthis.addOutputHtml(`<span=\"background-color:${colorStr}\">`);\n\t\t} else {\n\t\t\tthis.addOutputHtml(`<span=\"color:${colorStr}\">`);\n\t\t}\n\t}\n\t*/\n\n\tprivate async onExecuteButtonClick(_event: Event) { // eslint-disable-line @typescript-eslint/no-unused-vars\n\t\tconst compiledText = document.getElementById(\"compiledText\") as HTMLTextAreaElement;\n\n\t\tconst compiledScript = this.compiledCm ? this.compiledCm.getValue() as string : compiledText.value;\n\n\t\tconst output = await this.core.executeScript(compiledScript);\n\n\t\tthis.addOutputText(output + (output.endsWith(\"\\n\") ? \"\" : \"\\n\"));\n\t}\n\n\tprivate onCompiledTextChange() {\n\t\tconst autoExecuteInput = document.getElementById(\"autoExecuteInput\") as HTMLInputElement;\n\t\tif (autoExecuteInput.checked) {\n\t\t\tconst executeButton = window.document.getElementById(\"executeButton\") as HTMLButtonElement;\n\t\t\texecuteButton.dispatchEvent(new Event('click'));\n\t\t}\n\t}\n\n\tprivate onCompileButtonClick(_event: Event) { // eslint-disable-line @typescript-eslint/no-unused-vars\n\t\tconst basicText = document.getElementById(\"basicText\") as HTMLTextAreaElement;\n\t\tconst compiledText = document.getElementById(\"compiledText\") as HTMLTextAreaElement;\n\t\tconst input = this.basicCm ? this.basicCm.getValue() : basicText.value;\n\t\tconst compiledScript = this.core.compileScript(input);\n\n\t\tif (this.compiledCm) {\n\t\t\tthis.compiledCm.setValue(compiledScript);\n\t\t} else {\n\t\t\tcompiledText.value = compiledScript;\n\t\t\tconst autoExecuteInput = document.getElementById(\"autoExecuteInput\") as HTMLInputElement;\n\t\t\tif (autoExecuteInput.checked) {\n\t\t\t\tconst newEvent = new Event('change');\n\t\t\t\tcompiledText.dispatchEvent(newEvent);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async onbasicTextChange() {\n\t\tconst autoCompileInput = document.getElementById(\"autoCompileInput\") as HTMLInputElement;\n\t\tif (autoCompileInput.checked) {\n\t\t\tconst compileButton = window.document.getElementById(\"compileButton\") as HTMLButtonElement;\n\t\t\tcompileButton.dispatchEvent(new Event('click'));\n\t\t}\n\t}\n\n\tprivate setExampleSelect(name: string) {\n\t\tconst exampleSelect = document.getElementById(\"exampleSelect\") as HTMLSelectElement;\n\t\texampleSelect.value = name;\n\t}\n\n\tprivate onExampleSelectChange(event: Event) {\n\t\tconst exampleSelect = event.target as HTMLSelectElement;\n\n\t\tconst basicText = document.getElementById(\"basicText\") as HTMLTextAreaElement;\n\t\tconst value = this.core.getExample(exampleSelect.value);\n\n\t\tthis.setOutputText(\"\");\n\n\t\tif (this.basicCm) {\n\t\t\tthis.basicCm.setValue(value);\n\t\t} else {\n\t\t\tbasicText.value = value;\n\t\t\tbasicText.dispatchEvent(new Event('change'));\n\t\t}\n\t}\n\n\tprivate setExampleSelectOptions(examples: Record<string, string>) {\n\t\tconst exampleSelect = document.getElementById(\"exampleSelect\") as HTMLSelectElement;\n\n\t\tfor (const key of Object.keys(examples)) {\n\t\t\tconst script = examples[key];\n\t\t\tconst firstLine = script.slice(0, script.indexOf(\"\\n\"));\n\n\t\t\tconst option = window.document.createElement(\"option\");\n\t\t\toption.value = key;\n\t\t\toption.text = key;\n\t\t\toption.title = firstLine;\n\t\t\toption.selected = false;\n\t\t\texampleSelect.add(option);\n\t\t}\n\t}\n\n\tprivate onHelpButtonClick() {\n\t\twindow.open(\"https://github.com/benchmarko/LocoBasic/#readme\");\n\t}\n\n\tprivate static getErrorEventFn() {\n\t\tif (UI.getErrorEvent) {\n\t\t\treturn UI.getErrorEvent;\n\t\t}\n\n\t\tconst blob = new Blob(\n\t\t\t[`(${workerFn})();`],\n\t\t\t{ type: \"text/javascript\" }\n\t\t);\n\n\t\tconst worker = new Worker(window.URL.createObjectURL(blob));\n\t\t// Use a queue to ensure processNext only calls the worker once the worker is idle\n\t\tconst processingQueue: ProcessingQueueType[] = [];\n\t\tlet isProcessing = false;\n\n\t\tconst processNext = () => {\n\t\t\tisProcessing = true;\n\t\t\tconst { resolve, jsText } = processingQueue.shift() as ProcessingQueueType;\n\t\t\tworker.addEventListener(\n\t\t\t\t'message',\n\t\t\t\t({ data }) => {\n\t\t\t\t\tresolve(JSON.parse(data));\n\t\t\t\t\tif (processingQueue.length) {\n\t\t\t\t\t\tprocessNext();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisProcessing = false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{ once: true }\n\t\t\t);\n\t\t\tworker.postMessage(jsText);\n\t\t};\n\n\t\tconst getErrorEvent = (jsText: string): Promise<PlainErrorEventType> => {\n\t\t\treturn new Promise<PlainErrorEventType>((resolve) => {\n\t\t\t\tprocessingQueue.push({ resolve, jsText });\n\t\t\t\tif (!isProcessing) {\n\t\t\t\t\tprocessNext();\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tUI.getErrorEvent = getErrorEvent;\n\t\treturn getErrorEvent;\n\t}\n\n\tprivate static describeError(stringToEval: string, lineno: number, colno: number) {\n\t\tconst lines = stringToEval.split('\\n');\n\t\tconst line = lines[lineno - 1];\n\t\treturn `${line}\\n${' '.repeat(colno - 1) + '^'}`;\n\t}\n\n\tpublic async checkSyntax(str: string) {\n\t\tconst getErrorEvent = UI.getErrorEventFn();\n\n\t\tlet output = \"\";\n\t\tconst { lineno, colno, message } = await getErrorEvent(str);\n\t\tif (message === 'No Error: Parsing successful!') {\n\t\t\treturn \"\";\n\t\t}\n\t\toutput += `Syntax error thrown at: Line ${lineno - 2}, col: ${colno}\\n`; // lineNo -2 because of anonymous function added by new Function() constructor\n\t\toutput += UI.describeError(str, lineno - 2, colno) + \"\\n\";\n\t\toutput += message;\n\t\treturn output;\n\t}\n\n\tprivate fnDecodeUri(s: string) {\n\t\tlet decoded = \"\";\n\n\t\ttry {\n\t\t\tdecoded = decodeURIComponent(s.replace(/\\+/g, \" \"));\n\t\t} catch (err) {\n\t\t\tif (err instanceof Error) {\n\t\t\t\terr.message += \": \" + s;\n\t\t\t}\n\t\t\tconsole.error(err);\n\t\t}\n\t\treturn decoded;\n\t}\n\n\t// https://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript\n\tpublic parseUri(urlQuery: string, config: ConfigType): string[] {\n\t\tconst rSearch = /([^&=]+)=?([^&]*)/g,\n\t\t\targs: string[] = [];\n\n\t\tlet match: RegExpExecArray | null;\n\n\t\twhile ((match = rSearch.exec(urlQuery)) !== null) {\n\t\t\tconst name = this.fnDecodeUri(match[1]),\n\t\t\t\tvalue = this.fnDecodeUri(match[2]);\n\n\t\t\tif (value !== null && config[name] !== undefined) {\n\t\t\t\targs.push(name + \"=\" + value);\n\t\t\t}\n\t\t}\n\t\treturn args;\n\t}\n\n\tpublic onWindowLoad(_event: Event) { // eslint-disable-line @typescript-eslint/no-unused-vars\n\t\tconst basicText = window.document.getElementById(\"basicText\") as HTMLTextAreaElement;\n\t\tbasicText.addEventListener('change', () => this.onbasicTextChange());\n\n\t\tconst compiledText = window.document.getElementById(\"compiledText\") as HTMLTextAreaElement;\n\t\tcompiledText.addEventListener('change', () => this.onCompiledTextChange());\n\n\t\tconst compileButton = window.document.getElementById(\"compileButton\") as HTMLButtonElement;\n\t\tcompileButton.addEventListener('click', (event) => this.onCompileButtonClick(event), false);\n\n\t\tconst executeButton = window.document.getElementById(\"executeButton\") as HTMLButtonElement;\n\t\texecuteButton.addEventListener('click', (event) => this.onExecuteButtonClick(event), false);\n\n\t\tconst exampleSelect = window.document.getElementById(\"exampleSelect\") as HTMLSelectElement;\n\t\texampleSelect.addEventListener('change', (event) => this.onExampleSelectChange(event));\n\n\t\tconst helpButton = window.document.getElementById(\"helpButton\") as HTMLButtonElement;\n\t\thelpButton.addEventListener('click', () => this.onHelpButtonClick());\n\n\t\tconst WinCodeMirror = window.CodeMirror;\n\t\tif (WinCodeMirror) {\n\t\t\tthis.basicCm = WinCodeMirror.fromTextArea(basicText, {\n\t\t\t\tlineNumbers: true,\n\t\t\t\tmode: 'javascript'\n\t\t\t});\n\t\t\tthis.basicCm.on('changes', this.debounce(() => this.onbasicTextChange(), \"debounceCompile\"));\n\n\t\t\tthis.compiledCm = WinCodeMirror.fromTextArea(compiledText, {\n\t\t\t\tlineNumbers: true,\n\t\t\t\tmode: 'javascript'\n\t\t\t});\n\t\t\tthis.compiledCm.on('changes', this.debounce(() => this.onCompiledTextChange(), \"debounceExecute\"));\n\t\t}\n\n\t\tUI.asyncDelay(() => {\n\t\t\tconst core = this.core;\n\t\t\tthis.setExampleSelectOptions(core.getExampleObject());\n\n\t\t\tconst example = this.core.getConfig(\"example\");\n\t\t\tif (example) {\n\t\t\t\tthis.setExampleSelect(example as string);\n\t\t\t}\n\t\t\texampleSelect.dispatchEvent(new Event('change'));\n\t\t}, 10);\n\t}\n\n}"],"names":[],"mappings":"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"}