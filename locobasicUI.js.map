{"version":3,"file":"locobasicUI.js","sources":["../src/UI/UI.ts"],"sourcesContent":["import type { Editor } from 'codemirror';\nimport type { ConfigEntryType, ICore, IUI, IVmAdmin } from \"../Interfaces\";\n\n// Worker:\ntype PlainErrorEventType = {\n    lineno: number,\n    colno: number,\n    message: string\n};\n\ntype ProcessingQueueType = {\n    resolve: (value: PlainErrorEventType) => void,\n    jsText: string\n};\n\n// Worker function to handle JavaScript evaluation and error reporting\nconst workerFn = (): void => {\n    const doEvalAndReply = (jsText: string) => {\n        self.addEventListener(\n            'error',\n            (errorEvent) => {\n                errorEvent.preventDefault();\n                const { lineno, colno, message } = errorEvent;\n                const plainErrorEventObj: PlainErrorEventType = { lineno, colno, message };\n                self.postMessage(JSON.stringify(plainErrorEventObj));\n            },\n            { once: true }\n        );\n        new Function(\"_o\", jsText);\n        const plainErrorEventObj: PlainErrorEventType = {\n            lineno: -1,\n            colno: -1,\n            message: 'No Error: Parsing successful!'\n        };\n        self.postMessage(JSON.stringify(plainErrorEventObj));\n    };\n\n    self.addEventListener('message', (e) => {\n        doEvalAndReply(e.data);\n    });\n};\n\nexport class UI implements IUI {\n    private core?: ICore;\n    private vm?: IVmAdmin;\n    private basicCm?: Editor;\n    private compiledCm?: Editor;\n    private readonly keyBuffer: string[] = []; // buffered pressed keys\n    private escape = false;\n    private fnOnKeyPressHandler: (event: KeyboardEvent) => void;\n\n    private static getErrorEvent?: (s: string) => Promise<PlainErrorEventType>;\n\n    constructor() {\n        this.fnOnKeyPressHandler = (event: KeyboardEvent) => this.onOutputTextKeydown(event);\n    }\n\n    private debounce<T extends (...args: unknown[]) => void | Promise<void>>(func: T, fngetDelay: () => number): (...args: Parameters<T>) => void {\n        let timeoutId: ReturnType<typeof setTimeout>;\n        return function (this: unknown, ...args: Parameters<T>) {\n            const context = this;\n            const delay = fngetDelay();\n            clearTimeout(timeoutId);\n            timeoutId = setTimeout(() => {\n                func.apply(context, args);\n            }, delay);\n        };\n    }\n\n    private static asyncDelay(fn: () => void, timeout: number): Promise<number> {\n        return (async () => {\n            const timerId = window.setTimeout(fn, timeout);\n            return timerId;\n        })();\n    }\n\n    private getCore() {\n        if (!this.core) {\n            throw new Error(\"Core not initialized\");\n        }\n        return this.core;\n    }\n\n    public getEscape() {\n        return this.escape;\n    }\n\n    public addOutputText(value: string): void {\n        const outputText = document.getElementById(\"outputText\") as HTMLPreElement;\n        outputText.innerHTML += value;\n    }\n\n    public setOutputText(value: string): void {\n        const outputText = document.getElementById(\"outputText\") as HTMLPreElement;\n        outputText.innerText = value;\n    }\n\n    public getPaperColors(colorsForPens: string[]): string[] {\n        return colorsForPens.map((color) => `<span style=\"background-color: ${color}\">`);\n    }\n\n    public getPenColors(colorsForPens: string[]): string[] {\n        return colorsForPens.map((color) => `<span style=\"color: ${color}\">`);\n    }\n\n    /**\n     * Prompts the user with a message and returns the input.\n     * @param msg - The message to prompt.\n     * @returns A promise that resolves to the user input or null if canceled.\n     */\n    public prompt(msg: string): string | null {\n        const input = window.prompt(msg);\n        return input;\n    }\n\n    private setButtonDisabled(id: string, disabled: boolean) {\n        const button = window.document.getElementById(id) as HTMLButtonElement;\n        button.disabled = disabled;\n    }\n\n    private toggleAreaHidden(id: string, editor?: Editor): boolean {\n        const area = document.getElementById(id) as HTMLDivElement;\n        area.hidden = !area.hidden;\n        if (!area.hidden && editor) {\n            editor.refresh();\n        }\n        return !area.hidden;\n    }\n\n    private setClearLeft(id: string, clearLeft: boolean): void {\n        const area = document.getElementById(id) as HTMLDivElement;\n        area.style.clear = clearLeft ? \"left\" : \"\";\n    }\n\n    private onBasicAreaButtonClick(_event: Event){ // eslint-disable-line @typescript-eslint/no-unused-vars\n        const basicVisible = this.toggleAreaHidden(\"basicAreaInner\", this.basicCm);\n        const compiledAreaInner = document.getElementById(\"compiledAreaInner\") as HTMLDivElement;\n        this.setClearLeft(\"compiledArea\", !basicVisible || compiledAreaInner.hidden);\n    }\n\n    private onCompiledAreaButtonClick(_event: Event){ // eslint-disable-line @typescript-eslint/no-unused-vars\n        const compiledVisible = this.toggleAreaHidden(\"compiledAreaInner\", this.compiledCm);\n        const basicAreaInner = document.getElementById(\"basicAreaInner\") as HTMLDivElement;\n        this.setClearLeft(\"compiledArea\", !compiledVisible || basicAreaInner.hidden);\n        const outputAreaInner = document.getElementById(\"outputAreaInner\") as HTMLDivElement;\n        this.setClearLeft(\"outputArea\", !compiledVisible || outputAreaInner.hidden);\n    }\n\n    private onOutputAreaButtonClick(_event: Event){ // eslint-disable-line @typescript-eslint/no-unused-vars\n        const outputVisible = this.toggleAreaHidden(\"outputAreaInner\");\n        const compiledAreaInner = document.getElementById(\"compiledAreaInner\") as HTMLDivElement;\n        this.setClearLeft(\"outputArea\", !outputVisible || compiledAreaInner.hidden);\n    }\n\n    private async onExecuteButtonClick(_event: Event): Promise<void> { // eslint-disable-line @typescript-eslint/no-unused-vars\n        const core = this.getCore();\n        if (!this.vm) {\n            return;\n        }\n        const compiledScript = this.compiledCm ? this.compiledCm.getValue() : \"\";\n        this.setButtonDisabled(\"executeButton\", true);\n        this.setButtonDisabled(\"stopButton\", false);\n        this.escape = false;\n        this.keyBuffer.length = 0;\n        const outputText = window.document.getElementById(\"outputText\") as HTMLPreElement;\n        outputText.addEventListener(\"keydown\", this.fnOnKeyPressHandler, false);\n        const output = await core.executeScript(compiledScript, this.vm) || \"\";\n        outputText.removeEventListener(\"keydown\", this.fnOnKeyPressHandler, false);\n        this.setButtonDisabled(\"executeButton\", false);\n        this.setButtonDisabled(\"stopButton\", true);\n        this.addOutputText(output + (output.endsWith(\"\\n\") ? \"\" : \"\\n\"));\n    }\n\n    private onCompiledTextChange(): void {\n        const autoExecuteInput = document.getElementById(\"autoExecuteInput\") as HTMLInputElement;\n        if (autoExecuteInput.checked) {\n            const executeButton = window.document.getElementById(\"executeButton\") as HTMLButtonElement;\n            if (!executeButton.disabled) {\n                executeButton.dispatchEvent(new Event('click'));\n            }\n        }\n    }\n\n    private onCompileButtonClick(_event: Event): void { // eslint-disable-line @typescript-eslint/no-unused-vars\n        const core = this.getCore();\n        this.setButtonDisabled(\"compileButton\", true);\n        const input = this.basicCm ? this.basicCm.getValue() : \"\";\n        UI.asyncDelay(() => {\n            const compiledScript = core.compileScript(input) || \"\";\n\n            if (this.compiledCm) {\n                this.compiledCm.setValue(compiledScript);\n            }\n            this.setButtonDisabled(\"compileButton\", false);\n        }, 1);\n    }\n\n    private onStopButtonClick(_event: Event): void { // eslint-disable-line @typescript-eslint/no-unused-vars\n        this.escape = true;\n        this.setButtonDisabled(\"stopButton\", true);\n    }\n\n    private async onBasicTextChange(): Promise<void> {\n        const autoCompileInput = document.getElementById(\"autoCompileInput\") as HTMLInputElement;\n        if (autoCompileInput.checked) {\n            const compileButton = window.document.getElementById(\"compileButton\") as HTMLButtonElement;\n            if (!compileButton.disabled) {\n                compileButton.dispatchEvent(new Event('click'));\n            }\n        }\n    }\n\n    private setExampleSelect(name: string): void {\n        const exampleSelect = document.getElementById(\"exampleSelect\") as HTMLSelectElement;\n        exampleSelect.value = name;\n    }\n\n    private onExampleSelectChange(event: Event): void {\n        const core = this.getCore();\n        const exampleSelect = event.target as HTMLSelectElement;\n        const value = core.getExample(exampleSelect.value) || \"\";\n        this.setOutputText(\"\");\n\n        if (this.basicCm) {\n            this.basicCm.setValue(value);\n        }\n    }\n\n    private setExampleSelectOptions(examples: Record<string, string>): void {\n        const exampleSelect = document.getElementById(\"exampleSelect\") as HTMLSelectElement;\n        const maxTextLength = 35;\n        const regExp = /^(\\d+ )?REM /;\n\n        for (const key of Object.keys(examples)) {\n            const script = examples[key];\n            const firstLine = script.slice(0, script.indexOf(\"\\n\"));\n            const startsWithRem = regExp.test(firstLine);\n            const title = startsWithRem ? firstLine.replace(regExp, \"\") : firstLine;\n\n            const option = window.document.createElement(\"option\");\n            option.value = key;\n            option.text = startsWithRem ? title.substring(0, maxTextLength) : key;\n            option.title = title;\n            option.selected = false;\n            exampleSelect.add(option);\n        }\n    }\n\n    private onHelpButtonClick(): void {\n        window.open(\"https://github.com/benchmarko/LocoBasic/#readme\");\n    }\n\n    public getKeyFromBuffer(): string {\n\t\tconst key = this.keyBuffer.length ? this.keyBuffer.shift() as string : \"\";\n\t\treturn key;\n\t}\n\n    private putKeyInBuffer(key: string): void {\n\t\tthis.keyBuffer.push(key);\n    }\n\n    private onOutputTextKeydown(event: KeyboardEvent): void {\n        const key = event.key;\n        if (key === \"Escape\") {\n            this.escape = true;\n        } else if (key === \"Enter\") {\n            this.putKeyInBuffer(\"\\x0d\");\n            event.preventDefault();\n        } else if (key.length === 1 && event.ctrlKey === false && event.altKey === false) {\n            this.putKeyInBuffer(key);\n            event.preventDefault();\n        }\n    }\n\n    private static getErrorEventFn(): (s: string) => Promise<PlainErrorEventType> {\n        if (UI.getErrorEvent) {\n            return UI.getErrorEvent;\n        }\n\n        const blob = new Blob(\n            [`(${workerFn})();`],\n            { type: \"text/javascript\" }\n        );\n\n        const worker = new Worker(window.URL.createObjectURL(blob));\n        const processingQueue: ProcessingQueueType[] = [];\n        let isProcessing = false;\n\n        const processNext = () => {\n            isProcessing = true;\n            const { resolve, jsText } = processingQueue.shift() as ProcessingQueueType;\n            worker.addEventListener(\n                'message',\n                ({ data }) => {\n                    resolve(JSON.parse(data));\n                    if (processingQueue.length) {\n                        processNext();\n                    } else {\n                        isProcessing = false;\n                    }\n                },\n                { once: true }\n            );\n            worker.postMessage(jsText);\n        };\n\n        const getErrorEvent = (jsText: string): Promise<PlainErrorEventType> => {\n            return new Promise<PlainErrorEventType>((resolve) => {\n                processingQueue.push({ resolve, jsText });\n                if (!isProcessing) {\n                    processNext();\n                }\n            });\n        };\n\n        UI.getErrorEvent = getErrorEvent;\n        return getErrorEvent;\n    }\n\n    private static describeError(stringToEval: string, lineno: number, colno: number): string {\n        const lines = stringToEval.split('\\n');\n        const line = lines[lineno - 1];\n        return `${line}\\n${' '.repeat(colno - 1) + '^'}`;\n    }\n\n    public async checkSyntax(str: string): Promise<string> {\n        const getErrorEvent = UI.getErrorEventFn();\n\n        let output = \"\";\n        const { lineno, colno, message } = await getErrorEvent(str);\n        if (message === 'No Error: Parsing successful!') {\n            return \"\";\n        }\n        output += `Syntax error thrown at: Line ${lineno - 2}, col: ${colno}\\n`;\n        output += UI.describeError(str, lineno - 2, colno) + \"\\n\";\n        output += message;\n        return output;\n    }\n\n    private fnDecodeUri(s: string): string {\n        let decoded = \"\";\n\n        try {\n            decoded = decodeURIComponent(s.replace(/\\+/g, \" \"));\n        } catch (err) {\n            if (err instanceof Error) {\n                err.message += \": \" + s;\n            }\n            console.error(err);\n        }\n        return decoded;\n    }\n\n    private parseUri(config: Record<string, ConfigEntryType>): string[] {\n        const urlQuery = window.location.search.substring(1); \n        const rSearch = /([^&=]+)=?([^&]*)/g;\n        const args: string[] = [];\n        let match: RegExpExecArray | null;\n\n        while ((match = rSearch.exec(urlQuery)) !== null) {\n            const name = this.fnDecodeUri(match[1]);\n            const value = this.fnDecodeUri(match[2]);\n\n            if (value !== null && config[name] !== undefined) {\n                args.push(name + \"=\" + value);\n            }\n        }\n        return args;\n    }\n\n    public onWindowLoadContinue(core: ICore, vm: IVmAdmin): void {\n        this.core = core;\n        this.vm = vm;\n        const config = core.getConfigObject();\n        const args = this.parseUri(config);\n        core.parseArgs(args, config);\n        core.setOnCheckSyntax((s: string) => Promise.resolve(this.checkSyntax(s)));\n\n        const compileButton = window.document.getElementById(\"compileButton\") as HTMLButtonElement;\n        compileButton.addEventListener('click', (event) => this.onCompileButtonClick(event), false);\n\n        const executeButton = window.document.getElementById(\"executeButton\") as HTMLButtonElement;\n        executeButton.addEventListener('click', (event) => this.onExecuteButtonClick(event), false);\n\n        const stopButton = window.document.getElementById(\"stopButton\") as HTMLButtonElement;\n        stopButton.addEventListener('click', (event) => this.onStopButtonClick(event), false);\n\n        const exampleSelect = window.document.getElementById(\"exampleSelect\") as HTMLSelectElement;\n        exampleSelect.addEventListener('change', (event) => this.onExampleSelectChange(event));\n\n        const helpButton = window.document.getElementById(\"helpButton\") as HTMLButtonElement;\n        helpButton.addEventListener('click', () => this.onHelpButtonClick());\n\n        const WinCodeMirror = window.CodeMirror;\n        if (WinCodeMirror) {\n            const basicEditor = window.document.getElementById(\"basicEditor\") as HTMLElement;\n            this.basicCm = WinCodeMirror(basicEditor, {\n                lineNumbers: true,\n                mode: 'javascript' // should be 'basic' but not available\n            });\n            this.basicCm.on('changes', this.debounce(() => this.onBasicTextChange(), () => config.debounceCompile));\n\n            const compiledEditor = window.document.getElementById(\"compiledEditor\") as HTMLElement;\n            this.compiledCm = WinCodeMirror(compiledEditor, {\n                lineNumbers: true,\n                mode: 'javascript'\n            });\n            this.compiledCm.on('changes', this.debounce(() => this.onCompiledTextChange(), () => config.debounceExecute));\n        }\n\n        const basicAreaButton = window.document.getElementById(\"basicAreaButton\") as HTMLButtonElement;\n        basicAreaButton.addEventListener('click', (event) => this.onBasicAreaButtonClick(event), false);\n\n        const compiledAreaButton = window.document.getElementById(\"compiledAreaButton\") as HTMLButtonElement;\n        compiledAreaButton.addEventListener('click', (event) => this.onCompiledAreaButtonClick(event), false);\n\n        const outputAreaButton = window.document.getElementById(\"outputAreaButton\") as HTMLButtonElement;\n        outputAreaButton.addEventListener('click', (event) => this.onOutputAreaButtonClick(event), false);\n\n        UI.asyncDelay(() => {\n            const exampleObject = core.getExampleObject() || {};\n            this.setExampleSelectOptions(exampleObject);\n\n            const example = config.example;\n            if (example) {\n                this.setExampleSelect(example);\n            }\n            exampleSelect.dispatchEvent(new Event('change'));\n        }, 10);\n    }\n}\n"],"names":[],"mappings":";;;;;;IAeA;IACA,MAAM,QAAQ,GAAG,MAAW;IACxB,IAAA,MAAM,cAAc,GAAG,CAAC,MAAc,KAAI;YACtC,IAAI,CAAC,gBAAgB,CACjB,OAAO,EACP,CAAC,UAAU,KAAI;gBACX,UAAU,CAAC,cAAc,EAAE;gBAC3B,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,UAAU;gBAC7C,MAAM,kBAAkB,GAAwB,EAAE,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE;gBAC1E,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,kBAAkB,CAAC,CAAC;IACxD,SAAC,EACD,EAAE,IAAI,EAAE,IAAI,EAAE,CACjB;IACD,QAAA,IAAI,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC;IAC1B,QAAA,MAAM,kBAAkB,GAAwB;gBAC5C,MAAM,EAAE,CAAC,CAAC;gBACV,KAAK,EAAE,CAAC,CAAC;IACT,YAAA,OAAO,EAAE;aACZ;YACD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,kBAAkB,CAAC,CAAC;IACxD,KAAC;QAED,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAC,CAAC,KAAI;IACnC,QAAA,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC;IAC1B,KAAC,CAAC;IACN,CAAC;UAEY,EAAE,CAAA;IAWX,IAAA,WAAA,GAAA;IANiB,QAAA,IAAA,CAAA,SAAS,GAAa,EAAE,CAAC;YAClC,IAAM,CAAA,MAAA,GAAG,KAAK;IAMlB,QAAA,IAAI,CAAC,mBAAmB,GAAG,CAAC,KAAoB,KAAK,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC;;QAGhF,QAAQ,CAAyD,IAAO,EAAE,UAAwB,EAAA;IACtG,QAAA,IAAI,SAAwC;YAC5C,OAAO,UAAyB,GAAG,IAAmB,EAAA;gBAClD,MAAM,OAAO,GAAG,IAAI;IACpB,YAAA,MAAM,KAAK,GAAG,UAAU,EAAE;gBAC1B,YAAY,CAAC,SAAS,CAAC;IACvB,YAAA,SAAS,GAAG,UAAU,CAAC,MAAK;IACxB,gBAAA,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC;iBAC5B,EAAE,KAAK,CAAC;IACb,SAAC;;IAGG,IAAA,OAAO,UAAU,CAAC,EAAc,EAAE,OAAe,EAAA;YACrD,OAAO,CAAC,YAAW;gBACf,MAAM,OAAO,GAAG,MAAM,CAAC,UAAU,CAAC,EAAE,EAAE,OAAO,CAAC;IAC9C,YAAA,OAAO,OAAO;aACjB,GAAG;;QAGA,OAAO,GAAA;IACX,QAAA,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;IACZ,YAAA,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC;;YAE3C,OAAO,IAAI,CAAC,IAAI;;QAGb,SAAS,GAAA;YACZ,OAAO,IAAI,CAAC,MAAM;;IAGf,IAAA,aAAa,CAAC,KAAa,EAAA;YAC9B,MAAM,UAAU,GAAG,QAAQ,CAAC,cAAc,CAAC,YAAY,CAAmB;IAC1E,QAAA,UAAU,CAAC,SAAS,IAAI,KAAK;;IAG1B,IAAA,aAAa,CAAC,KAAa,EAAA;YAC9B,MAAM,UAAU,GAAG,QAAQ,CAAC,cAAc,CAAC,YAAY,CAAmB;IAC1E,QAAA,UAAU,CAAC,SAAS,GAAG,KAAK;;IAGzB,IAAA,cAAc,CAAC,aAAuB,EAAA;IACzC,QAAA,OAAO,aAAa,CAAC,GAAG,CAAC,CAAC,KAAK,KAAK,CAAA,+BAAA,EAAkC,KAAK,CAAA,EAAA,CAAI,CAAC;;IAG7E,IAAA,YAAY,CAAC,aAAuB,EAAA;IACvC,QAAA,OAAO,aAAa,CAAC,GAAG,CAAC,CAAC,KAAK,KAAK,CAAA,oBAAA,EAAuB,KAAK,CAAA,EAAA,CAAI,CAAC;;IAGzE;;;;IAIG;IACI,IAAA,MAAM,CAAC,GAAW,EAAA;YACrB,MAAM,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC;IAChC,QAAA,OAAO,KAAK;;QAGR,iBAAiB,CAAC,EAAU,EAAE,QAAiB,EAAA;YACnD,MAAM,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAsB;IACtE,QAAA,MAAM,CAAC,QAAQ,GAAG,QAAQ;;QAGtB,gBAAgB,CAAC,EAAU,EAAE,MAAe,EAAA;YAChD,MAAM,IAAI,GAAG,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAmB;IAC1D,QAAA,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,MAAM;IAC1B,QAAA,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,MAAM,EAAE;gBACxB,MAAM,CAAC,OAAO,EAAE;;IAEpB,QAAA,OAAO,CAAC,IAAI,CAAC,MAAM;;QAGf,YAAY,CAAC,EAAU,EAAE,SAAkB,EAAA;YAC/C,MAAM,IAAI,GAAG,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAmB;IAC1D,QAAA,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,SAAS,GAAG,MAAM,GAAG,EAAE;;IAGtC,IAAA,sBAAsB,CAAC,MAAa,EAAA;IACxC,QAAA,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,IAAI,CAAC,OAAO,CAAC;YAC1E,MAAM,iBAAiB,GAAG,QAAQ,CAAC,cAAc,CAAC,mBAAmB,CAAmB;IACxF,QAAA,IAAI,CAAC,YAAY,CAAC,cAAc,EAAE,CAAC,YAAY,IAAI,iBAAiB,CAAC,MAAM,CAAC;;IAGxE,IAAA,yBAAyB,CAAC,MAAa,EAAA;IAC3C,QAAA,MAAM,eAAe,GAAG,IAAI,CAAC,gBAAgB,CAAC,mBAAmB,EAAE,IAAI,CAAC,UAAU,CAAC;YACnF,MAAM,cAAc,GAAG,QAAQ,CAAC,cAAc,CAAC,gBAAgB,CAAmB;IAClF,QAAA,IAAI,CAAC,YAAY,CAAC,cAAc,EAAE,CAAC,eAAe,IAAI,cAAc,CAAC,MAAM,CAAC;YAC5E,MAAM,eAAe,GAAG,QAAQ,CAAC,cAAc,CAAC,iBAAiB,CAAmB;IACpF,QAAA,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,CAAC,eAAe,IAAI,eAAe,CAAC,MAAM,CAAC;;IAGvE,IAAA,uBAAuB,CAAC,MAAa,EAAA;YACzC,MAAM,aAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,iBAAiB,CAAC;YAC9D,MAAM,iBAAiB,GAAG,QAAQ,CAAC,cAAc,CAAC,mBAAmB,CAAmB;IACxF,QAAA,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,CAAC,aAAa,IAAI,iBAAiB,CAAC,MAAM,CAAC;;QAGvE,MAAM,oBAAoB,CAAC,MAAa,EAAA;IAC5C,QAAA,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE;IAC3B,QAAA,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE;gBACV;;IAEJ,QAAA,MAAM,cAAc,GAAG,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,GAAG,EAAE;IACxE,QAAA,IAAI,CAAC,iBAAiB,CAAC,eAAe,EAAE,IAAI,CAAC;IAC7C,QAAA,IAAI,CAAC,iBAAiB,CAAC,YAAY,EAAE,KAAK,CAAC;IAC3C,QAAA,IAAI,CAAC,MAAM,GAAG,KAAK;IACnB,QAAA,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC;YACzB,MAAM,UAAU,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,YAAY,CAAmB;YACjF,UAAU,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,mBAAmB,EAAE,KAAK,CAAC;IACvE,QAAA,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,cAAc,EAAE,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE;YACtE,UAAU,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,mBAAmB,EAAE,KAAK,CAAC;IAC1E,QAAA,IAAI,CAAC,iBAAiB,CAAC,eAAe,EAAE,KAAK,CAAC;IAC9C,QAAA,IAAI,CAAC,iBAAiB,CAAC,YAAY,EAAE,IAAI,CAAC;YAC1C,IAAI,CAAC,aAAa,CAAC,MAAM,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;;QAG5D,oBAAoB,GAAA;YACxB,MAAM,gBAAgB,GAAG,QAAQ,CAAC,cAAc,CAAC,kBAAkB,CAAqB;IACxF,QAAA,IAAI,gBAAgB,CAAC,OAAO,EAAE;gBAC1B,MAAM,aAAa,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAsB;IAC1F,YAAA,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE;oBACzB,aAAa,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;;;;IAKnD,IAAA,oBAAoB,CAAC,MAAa,EAAA;IACtC,QAAA,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE;IAC3B,QAAA,IAAI,CAAC,iBAAiB,CAAC,eAAe,EAAE,IAAI,CAAC;IAC7C,QAAA,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,GAAG,EAAE;IACzD,QAAA,EAAE,CAAC,UAAU,CAAC,MAAK;gBACf,MAAM,cAAc,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,EAAE;IAEtD,YAAA,IAAI,IAAI,CAAC,UAAU,EAAE;IACjB,gBAAA,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,cAAc,CAAC;;IAE5C,YAAA,IAAI,CAAC,iBAAiB,CAAC,eAAe,EAAE,KAAK,CAAC;aACjD,EAAE,CAAC,CAAC;;IAGD,IAAA,iBAAiB,CAAC,MAAa,EAAA;IACnC,QAAA,IAAI,CAAC,MAAM,GAAG,IAAI;IAClB,QAAA,IAAI,CAAC,iBAAiB,CAAC,YAAY,EAAE,IAAI,CAAC;;IAGtC,IAAA,MAAM,iBAAiB,GAAA;YAC3B,MAAM,gBAAgB,GAAG,QAAQ,CAAC,cAAc,CAAC,kBAAkB,CAAqB;IACxF,QAAA,IAAI,gBAAgB,CAAC,OAAO,EAAE;gBAC1B,MAAM,aAAa,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAsB;IAC1F,YAAA,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE;oBACzB,aAAa,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;;;;IAKnD,IAAA,gBAAgB,CAAC,IAAY,EAAA;YACjC,MAAM,aAAa,GAAG,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAsB;IACnF,QAAA,aAAa,CAAC,KAAK,GAAG,IAAI;;IAGtB,IAAA,qBAAqB,CAAC,KAAY,EAAA;IACtC,QAAA,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE;IAC3B,QAAA,MAAM,aAAa,GAAG,KAAK,CAAC,MAA2B;IACvD,QAAA,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,EAAE;IACxD,QAAA,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC;IAEtB,QAAA,IAAI,IAAI,CAAC,OAAO,EAAE;IACd,YAAA,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC;;;IAI5B,IAAA,uBAAuB,CAAC,QAAgC,EAAA;YAC5D,MAAM,aAAa,GAAG,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAsB;YACnF,MAAM,aAAa,GAAG,EAAE;YACxB,MAAM,MAAM,GAAG,cAAc;YAE7B,KAAK,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;IACrC,YAAA,MAAM,MAAM,GAAG,QAAQ,CAAC,GAAG,CAAC;IAC5B,YAAA,MAAM,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBACvD,MAAM,aAAa,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC;IAC5C,YAAA,MAAM,KAAK,GAAG,aAAa,GAAG,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,GAAG,SAAS;gBAEvE,MAAM,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC;IACtD,YAAA,MAAM,CAAC,KAAK,GAAG,GAAG;IAClB,YAAA,MAAM,CAAC,IAAI,GAAG,aAAa,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC,EAAE,aAAa,CAAC,GAAG,GAAG;IACrE,YAAA,MAAM,CAAC,KAAK,GAAG,KAAK;IACpB,YAAA,MAAM,CAAC,QAAQ,GAAG,KAAK;IACvB,YAAA,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC;;;QAIzB,iBAAiB,GAAA;IACrB,QAAA,MAAM,CAAC,IAAI,CAAC,iDAAiD,CAAC;;QAG3D,gBAAgB,GAAA;YACzB,MAAM,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,EAAY,GAAG,EAAE;IACzE,QAAA,OAAO,GAAG;;IAGA,IAAA,cAAc,CAAC,GAAW,EAAA;IACpC,QAAA,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC;;IAGd,IAAA,mBAAmB,CAAC,KAAoB,EAAA;IAC5C,QAAA,MAAM,GAAG,GAAG,KAAK,CAAC,GAAG;IACrB,QAAA,IAAI,GAAG,KAAK,QAAQ,EAAE;IAClB,YAAA,IAAI,CAAC,MAAM,GAAG,IAAI;;IACf,aAAA,IAAI,GAAG,KAAK,OAAO,EAAE;IACxB,YAAA,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC;gBAC3B,KAAK,CAAC,cAAc,EAAE;;IACnB,aAAA,IAAI,GAAG,CAAC,MAAM,KAAK,CAAC,IAAI,KAAK,CAAC,OAAO,KAAK,KAAK,IAAI,KAAK,CAAC,MAAM,KAAK,KAAK,EAAE;IAC9E,YAAA,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC;gBACxB,KAAK,CAAC,cAAc,EAAE;;;IAItB,IAAA,OAAO,eAAe,GAAA;IAC1B,QAAA,IAAI,EAAE,CAAC,aAAa,EAAE;gBAClB,OAAO,EAAE,CAAC,aAAa;;IAG3B,QAAA,MAAM,IAAI,GAAG,IAAI,IAAI,CACjB,CAAC,CAAI,CAAA,EAAA,QAAQ,CAAM,IAAA,CAAA,CAAC,EACpB,EAAE,IAAI,EAAE,iBAAiB,EAAE,CAC9B;IAED,QAAA,MAAM,MAAM,GAAG,IAAI,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YAC3D,MAAM,eAAe,GAA0B,EAAE;YACjD,IAAI,YAAY,GAAG,KAAK;YAExB,MAAM,WAAW,GAAG,MAAK;gBACrB,YAAY,GAAG,IAAI;gBACnB,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,eAAe,CAAC,KAAK,EAAyB;gBAC1E,MAAM,CAAC,gBAAgB,CACnB,SAAS,EACT,CAAC,EAAE,IAAI,EAAE,KAAI;oBACT,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IACzB,gBAAA,IAAI,eAAe,CAAC,MAAM,EAAE;IACxB,oBAAA,WAAW,EAAE;;yBACV;wBACH,YAAY,GAAG,KAAK;;IAE5B,aAAC,EACD,EAAE,IAAI,EAAE,IAAI,EAAE,CACjB;IACD,YAAA,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC;IAC9B,SAAC;IAED,QAAA,MAAM,aAAa,GAAG,CAAC,MAAc,KAAkC;IACnE,YAAA,OAAO,IAAI,OAAO,CAAsB,CAAC,OAAO,KAAI;oBAChD,eAAe,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC;oBACzC,IAAI,CAAC,YAAY,EAAE;IACf,oBAAA,WAAW,EAAE;;IAErB,aAAC,CAAC;IACN,SAAC;IAED,QAAA,EAAE,CAAC,aAAa,GAAG,aAAa;IAChC,QAAA,OAAO,aAAa;;IAGhB,IAAA,OAAO,aAAa,CAAC,YAAoB,EAAE,MAAc,EAAE,KAAa,EAAA;YAC5E,MAAM,KAAK,GAAG,YAAY,CAAC,KAAK,CAAC,IAAI,CAAC;YACtC,MAAM,IAAI,GAAG,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;IAC9B,QAAA,OAAO,CAAG,EAAA,IAAI,CAAK,EAAA,EAAA,GAAG,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,GAAG,EAAE;;QAG7C,MAAM,WAAW,CAAC,GAAW,EAAA;IAChC,QAAA,MAAM,aAAa,GAAG,EAAE,CAAC,eAAe,EAAE;YAE1C,IAAI,MAAM,GAAG,EAAE;IACf,QAAA,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,MAAM,aAAa,CAAC,GAAG,CAAC;IAC3D,QAAA,IAAI,OAAO,KAAK,+BAA+B,EAAE;IAC7C,YAAA,OAAO,EAAE;;YAEb,MAAM,IAAI,gCAAgC,MAAM,GAAG,CAAC,CAAU,OAAA,EAAA,KAAK,IAAI;IACvE,QAAA,MAAM,IAAI,EAAE,CAAC,aAAa,CAAC,GAAG,EAAE,MAAM,GAAG,CAAC,EAAE,KAAK,CAAC,GAAG,IAAI;YACzD,MAAM,IAAI,OAAO;IACjB,QAAA,OAAO,MAAM;;IAGT,IAAA,WAAW,CAAC,CAAS,EAAA;YACzB,IAAI,OAAO,GAAG,EAAE;IAEhB,QAAA,IAAI;IACA,YAAA,OAAO,GAAG,kBAAkB,CAAC,CAAC,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;;YACrD,OAAO,GAAG,EAAE;IACV,YAAA,IAAI,GAAG,YAAY,KAAK,EAAE;IACtB,gBAAA,GAAG,CAAC,OAAO,IAAI,IAAI,GAAG,CAAC;;IAE3B,YAAA,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC;;IAEtB,QAAA,OAAO,OAAO;;IAGV,IAAA,QAAQ,CAAC,MAAuC,EAAA;IACpD,QAAA,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;YACpD,MAAM,OAAO,GAAG,oBAAoB;YACpC,MAAM,IAAI,GAAa,EAAE;IACzB,QAAA,IAAI,KAA6B;IAEjC,QAAA,OAAO,CAAC,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI,EAAE;gBAC9C,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBACvC,MAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBAExC,IAAI,KAAK,KAAK,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,KAAK,SAAS,EAAE;oBAC9C,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,GAAG,GAAG,KAAK,CAAC;;;IAGrC,QAAA,OAAO,IAAI;;QAGR,oBAAoB,CAAC,IAAW,EAAE,EAAY,EAAA;IACjD,QAAA,IAAI,CAAC,IAAI,GAAG,IAAI;IAChB,QAAA,IAAI,CAAC,EAAE,GAAG,EAAE;IACZ,QAAA,MAAM,MAAM,GAAG,IAAI,CAAC,eAAe,EAAE;YACrC,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;IAClC,QAAA,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,MAAM,CAAC;YAC5B,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAS,KAAK,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;YAE1E,MAAM,aAAa,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAsB;IAC1F,QAAA,aAAa,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,KAAK,KAAK,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC;YAE3F,MAAM,aAAa,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAsB;IAC1F,QAAA,aAAa,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,KAAK,KAAK,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC;YAE3F,MAAM,UAAU,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,YAAY,CAAsB;IACpF,QAAA,UAAU,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,KAAK,KAAK,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC;YAErF,MAAM,aAAa,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAsB;IAC1F,QAAA,aAAa,CAAC,gBAAgB,CAAC,QAAQ,EAAE,CAAC,KAAK,KAAK,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;YAEtF,MAAM,UAAU,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,YAAY,CAAsB;IACpF,QAAA,UAAU,CAAC,gBAAgB,CAAC,OAAO,EAAE,MAAM,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAEpE,QAAA,MAAM,aAAa,GAAG,MAAM,CAAC,UAAU;YACvC,IAAI,aAAa,EAAE;gBACf,MAAM,WAAW,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,aAAa,CAAgB;IAChF,YAAA,IAAI,CAAC,OAAO,GAAG,aAAa,CAAC,WAAW,EAAE;IACtC,gBAAA,WAAW,EAAE,IAAI;oBACjB,IAAI,EAAE,YAAY;IACrB,aAAA,CAAC;gBACF,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI,CAAC,iBAAiB,EAAE,EAAE,MAAM,MAAM,CAAC,eAAe,CAAC,CAAC;gBAEvG,MAAM,cAAc,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,gBAAgB,CAAgB;IACtF,YAAA,IAAI,CAAC,UAAU,GAAG,aAAa,CAAC,cAAc,EAAE;IAC5C,gBAAA,WAAW,EAAE,IAAI;IACjB,gBAAA,IAAI,EAAE;IACT,aAAA,CAAC;gBACF,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI,CAAC,oBAAoB,EAAE,EAAE,MAAM,MAAM,CAAC,eAAe,CAAC,CAAC;;YAGjH,MAAM,eAAe,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,iBAAiB,CAAsB;IAC9F,QAAA,eAAe,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,KAAK,KAAK,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC;YAE/F,MAAM,kBAAkB,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,oBAAoB,CAAsB;IACpG,QAAA,kBAAkB,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,KAAK,KAAK,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC;YAErG,MAAM,gBAAgB,GAAG,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,kBAAkB,CAAsB;IAChG,QAAA,gBAAgB,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,KAAK,KAAK,IAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC;IAEjG,QAAA,EAAE,CAAC,UAAU,CAAC,MAAK;gBACf,MAAM,aAAa,GAAG,IAAI,CAAC,gBAAgB,EAAE,IAAI,EAAE;IACnD,YAAA,IAAI,CAAC,uBAAuB,CAAC,aAAa,CAAC;IAE3C,YAAA,MAAM,OAAO,GAAG,MAAM,CAAC,OAAO;gBAC9B,IAAI,OAAO,EAAE;IACT,gBAAA,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC;;gBAElC,aAAa,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC;aACnD,EAAE,EAAE,CAAC;;IAEb;;;;;;;;"}